# 🚀 Word 智能填写系统 - 快速开始（10分钟）

## 📋 系统功能

这个系统可以自动化地填写Word文档，并保持原始格式完全不变。它使用大语言模型(LLM)来理解文档内容和数据，然后智能地填写相应的字段。

**核心优势：**
- ✓ 自动分割和合并Word页面（保持原格式）
- ✓ 使用大模型智能理解和填写
- ✓ 支持多种LLM服务（OpenAI、Claude、通义千问等）
- ✓ 完善的提示词模板库
- ✓ 一键自动化工作流

---

## ⚡ 3分钟快速开始

### 1️⃣ 配置LLM（2分钟）

```bash
python setup_llm_config.py
```

按照提示操作：
```
请选择LLM服务商:
  1. OpenAI (ChatGPT)
  2. Anthropic Claude
  3. 阿里通义千问
  4. 智谱清言
  5. 自定义API

选择 [1-5]: 1

请输入 API Key: sk-your-key-here

请输入 API URL: https://api.openai.com/v1

请输入 Model 名称: gpt-4

...

确认保存配置? (y/n): y
```

### 2️⃣ 准备数据（1分钟）

编辑 `fill_data.json`（或参考 `fill_data_sample.json`）：

```json
{
  "page_1": {
    "project_name": "你的项目名称",
    "package_number": "包编号"
  },
  "page_2": {
    "company_name": "公司名称",
    "legal_representative": "法人代表名称"
  }
}
```

### 3️⃣ 运行工作流（1分钟）

```bash
python smart_workflow.py
```

系统会自动执行：
1. 分割Word页面
2. 检查LLM配置
3. 检查填充数据
4. 调用大模型处理每一页
5. 合并修改后的页面
6. 生成最终Word文档

完成后，打开 `output_document.docx` 查看结果！

---

## 📊 工作流示意图

```
template.docx (原始文档)
      ↓
  [分割页面]
      ↓
  split_pages/
  ├── page_1.xml
  ├── page_2.xml
  └── ...
      ↓
  [大模型处理]  ← fill_data.json (填充数据)
  [llm_connector.py + prompt_library.py]
      ↓
  修改后的XML文件
      ↓
  [合并页面]
      ↓
  merged_document.xml
      ↓
  [转为Word]
      ↓
  output_document.docx ✓
```

---

## 🔑 关键文件说明

| 文件 | 说明 | 必需 |
|------|------|------|
| `llm_config.json` | LLM配置（API密钥、模型等） | ✓ |
| `fill_data.json` | 填充数据（需要填写的内容） | ✓ |
| `template.docx` | 原始Word文档 | ✓ |
| `smart_workflow.py` | 完整工作流脚本 | ✓ |
| `split_pages.py` | 页面分割脚本 | ✓ |
| `process_with_llm.py` | LLM处理脚本 | ✓ |
| `merge_pages.py` | 页面合并脚本 | ✓ |
| `xml_to_docx.py` | XML转Word脚本 | ✓ |

---

## 🎯 常见场景

### 场景1：填写招标投标文件

**步骤：**
1. 运行配置向导，选择OpenAI或Claude
2. 编辑fill_data.json，填入：
   - 项目名称、包编号、预算
   - 公司信息、法人代表、联系方式
   - 服务内容、服务期限
3. 运行smart_workflow.py
4. 检查output_document.docx

**示例数据：**
```json
{
  "page_1": {
    "project_name": "某市政务数据库建设项目",
    "package_code": "PKG2026001",
    "budget": "1000万元"
  },
  "page_2": {
    "company_name": "某某科技有限公司",
    "unified_credit_code": "91110000123456789X"
  }
}
```

### 场景2：填写合同模板

**步骤：**
1. 准备包含各种条款的合同模板
2. 配置LLM
3. 编辑fill_data.json，填入：
   - 合同双方信息
   - 金额、期限、条款等
4. 运行工作流
5. 获得自动填写的合同

### 场景3：批量生成多个文档版本

**脚本示例：**
```python
projects = [
    {"name": "项目A", "budget": "100万"},
    {"name": "项目B", "budget": "200万"},
    {"name": "项目C", "budget": "300万"},
]

for project in projects:
    # 1. 更新fill_data.json
    # 2. 运行smart_workflow.py
    # 3. 重命名output_document.docx
    pass
```

---

## 🛠️ 配置不同的LLM服务

### OpenAI (推荐)
```
服务商: 1 (OpenAI)
API Key: sk-... (从 https://platform.openai.com/api-keys 获取)
API URL: https://api.openai.com/v1
Model: gpt-4 (或 gpt-3.5-turbo)
```

### Claude (Anthropic)
```
服务商: 2 (Claude)
API Key: sk-ant-... (从 https://console.anthropic.com/ 获取)
API URL: https://api.anthropic.com/v1
Model: claude-3-opus-20240229
```

### 通义千问 (阿里)
```
服务商: 3 (通义千问)
API Key: sk-... (从阿里云控制台获取)
API URL: https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
Model: qwen-max
```

### 自定义API
```
服务商: 5 (自定义)
API Key: your-api-key
API URL: https://your-api.com/endpoint
Model: your-model-name
```

---

## 📝 数据文件格式

### fill_data.json 完整示例

```json
{
  "page_1": {
    "title": "首页标题",
    "subtitle": "副标题",
    "date": "2026-01-13"
  },
  "page_2": {
    "section_title": "第二章 内容",
    "field1": "值1",
    "field2": "值2"
  },
  "page_3": {
    "table_row_1": ["数据1", "数据2", "数据3"],
    "table_row_2": ["数据4", "数据5", "数据6"]
  },
  "global": {
    "project_code": "全局使用的项目代码",
    "company_name": "全局使用的公司名称"
  }
}
```

### 数据验证

系统会自动检查：
- ✓ JSON格式是否正确
- ✓ 必填字段是否完整
- ✓ 数据类型是否匹配

---

## ⚙️ 工作流详解

### 步骤1：前置条件检查
- 检查Python环境
- 检查必要的库（lxml, requests）
- 检查template.docx是否存在

### 步骤2：分割页面
- 使用split_pages.py分割Word文档
- 生成split_pages/目录，包含page_1.xml到page_N.xml
- 保留所有原始格式和样式

### 步骤3：检查LLM配置
- 验证llm_config.json存在且有效
- 显示当前配置的服务商和模型

### 步骤4：检查填充数据
- 验证fill_data.json存在且有效
- 显示数据条目数量

### 步骤5：LLM处理页面
- 对每一页调用LLM
- LLM分析页面内容和字段
- 根据提供的数据填写字段
- 保存修改后的XML

### 步骤6：合并页面
- 使用merge_pages.py合并所有页面
- 生成merged_document.xml

### 步骤7：转为Word
- 使用xml_to_docx.py转换为Word
- 生成output_document.docx

---

## 🔍 检查结果

生成output_document.docx后：

1. **用Word打开**
   - 检查是否所有字段都被正确填写
   - 检查格式是否保持一致

2. **对比原始文档**
   - 对比模板和输出文档
   - 验证数据准确性

3. **手动修正（如需要）
   - 对于填写不准确的字段，手动调整
   - 或修改fill_data.json重新运行

---

## 🐛 常见问题

**Q: LLM API调用失败怎么办？**  
A: 
1. 检查网络连接
2. 检查API Key是否正确
3. 检查API URL是否正确
4. 检查LLM服务是否可用

**Q: 填写内容不准确？**  
A:
1. 检查fill_data.json中的数据
2. 优化提示词（编辑prompt_library.py）
3. 使用更高性能的模型（如gpt-4）

**Q: Word文档打不开？**  
A:
1. 检查原始template.docx是否完整
2. 查看process_with_llm.py的日志
3. 尝试重新运行工作流

**Q: 页面格式被破坏？**  
A:
1. 使用xml_validation模板修复
2. 检查原始template.docx
3. 查看split_pages中的XML文件

---

## 💡 提示

- 💰 **成本控制**：使用gpt-3.5-turbo而不是gpt-4可以降低成本
- ⚡ **速度优化**：调低temperature参数可以加快处理速度
- 📚 **数据质量**：好的fill_data.json直接影响输出质量
- 🔑 **安全性**：不要将API Key上传到公开仓库

---

## 📚 更多帮助

详细文档：阅读 `使用指南.md`

包含内容：
- 所有模块的详细说明
- 提示词优化技巧
- 性能优化方案
- 高级用法示例
- 故障排除指南

---

## ✅ 下一步

1. ✅ 运行 `python setup_llm_config.py` 配置LLM
2. ✅ 编辑 `fill_data.json` 准备数据
3. ✅ 运行 `python smart_workflow.py` 自动填写
4. ✅ 打开 `output_document.docx` 查看结果
5. ✅ 根据需要进行手动调整

---

**准备好了吗？开始吧！** 🎉

```bash
python setup_llm_config.py
```
